# GEMINI.md

This file provides guidance to Gemini when working with code in this repository.

## Project Overview

Explico Learning is a modern TypeScript/React-based interactive walkthrough editor that compiles to Google Apps Script. It allows users to create hotspot-enabled presentations with background media (images, videos, YouTube). The app features a project dashboard and hotspot editor with real-time preview capabilities, all persisted to Google Sheets.

**Live URLs:**
- Web App: https://script.google.com/macros/s/AKfycbw9ZicNfjF7nSt_lCpYoI3MXEi_McVLAW3dzBClcTVz-QgsJ_nPDTRsQA0ELCK5fyde/exec
- Apps Script Editor: https://script.google.com/d/1YiQsdE97f3dM50Y26dgjqPUCjIIbMGWX5U2yVha8fu1264DtIj0VJWh_/edit

## Development Commands

### TypeScript Development
```bash
# Build and type-check
npm run build
npm run type-check

# Development workflow
npm run dev  # Watch mode
npm run lint
npm run test

# Quality checks
npm run quality  # Run all checks

# Deployment
npm run deploy      # Production: quality + build + deploy
npm run deploy:dev  # Development: build + deploy (skip quality)
./build.sh          # Manual build
clasp push --force  # Manual push
```

### File Structure
- `src/` - TypeScript source code
  - `src/client/` - React components and client-side TypeScript
  - `src/server/` - Server-side TypeScript (compiles to Google Apps Script)
  - `src/shared/` - Shared types, constants, and utilities
- `dist/` - Built files ready for deployment (generated by webpack + build.sh)
- `services/` - Legacy JavaScript services (being migrated to TypeScript)
- `templates/` - HTML templates
- `package.json` - NPM dependencies and build scripts
- `webpack.config.js` - TypeScript compilation configuration
- `tsconfig.json` - TypeScript configuration
- `appsscript.json` - Google Apps Script project configuration
- `.clasp.json` - Deployment configuration (script ID, root dir)

## Architecture

### Modern TypeScript/React Architecture
The application follows a modern component-based architecture:

**Server-Side (`src/server/`):**
- `Code.ts` - Main entry point and routing (compiles to Code.gs)
- `constants.ts` - Application constants (compiles to constants.gs)
- `services/` - Server-side TypeScript services

**Client-Side React (`src/client/`):**
- `components/ProjectDashboard.tsx` - Project management
- `components/AppHeader.tsx` - Application header
- `components/MainCanvas.tsx` - Interactive canvas
- `components/ConfigPanel.tsx` - Configuration forms
- `components/HotspotEditor.tsx` - Hotspot editing
- `components/common/` - Reusable components

**Legacy Services (`services/` - being migrated):**
- `GoogleSheetsAPI.js` - Data persistence
- `HotspotManager.js` - Hotspot operations
- `EventTypeHandlers.js` - Event handling
- `MediaHandler.js` - Media processing
- `ProjectManager_server.js` - Server-side project logic
- `ProjectManager_client.js` - Client-side project logic

### Data Storage Structure
Each project creates a Google Spreadsheet with sheets:
- **Projects** - Project metadata, settings, analytics
- **Slides** - Slide data, media URLs, ordering  
- **Hotspots** - Complete hotspot configurations with positioning and events
- **Analytics** - User interaction tracking and metrics

### Page Routing
The main `Code.gs` file (compiled from `src/server/Code.ts`) handles routing:
- `/exec` (default) → `main-app.html` - React-based project dashboard
- `/exec?page=editor&project={id}` → `editor-template.html` - React-based hotspot editor

## Development Guidelines

### TypeScript Development Workflow
1. **Edit source**: Modify TypeScript files in `src/`
2. **Type checking**: Run `npm run type-check` to validate types
3. **Build**: Run `npm run build` or `npm run build:dev`
4. **Test**: Run `npm run test` for unit tests
5. **Deploy**: Use `npm run deploy` (production) or `npm run deploy:dev`

### Working with React Components
1. Create `.tsx` files in `src/client/components/`
2. Use TypeScript interfaces from `src/shared/types/`
3. Import constants from `src/shared/constants/`
4. Follow React best practices (hooks, functional components)
5. Add proper TypeScript typing and error handling

### Adding New Hotspot Event Types
1. Add event type to `src/shared/constants/index.ts`
2. Update TypeScript interfaces in `src/shared/types/`
3. Implement handler in `EventTypeHandlers.js` (legacy - to be migrated)
4. Add configuration UI in `ConfigPanel.tsx`
5. Test in the React-based hotspot editor

### Migration Strategy (Legacy → TypeScript)
- **Phase 1**: Client-side components migrated to React/TypeScript
- **Phase 2**: Server-side services migration in progress
- **Phase 3**: Complete legacy JavaScript removal
- **Current**: Hybrid state with both systems working together

### Google Sheets Integration
- Each project gets its own spreadsheet for data isolation
- Use batch operations in `GoogleSheetsAPI.js` for performance
- Column mappings defined in `SHEETS_CONFIG` constants
- Relationship integrity maintained through service layer

## Deployment Notes

### Modern Deployment Process
- **Production**: `npm run deploy` (includes all quality checks)
- **Development**: `npm run deploy:dev` (faster, skips some checks)
- **Manual build**: `./build.sh && clasp push --force`

### Quality Gates
- TypeScript compilation must succeed
- ESLint rules must pass
- Unit tests must pass (for production)
- Manual testing recommended after deployment
- Monitor Google Apps Script execution logs
