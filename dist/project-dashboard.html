<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Dashboard - Explico Learning</title>
    
    <!-- Preconnect to external services -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    
    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Spline+Sans:wght@400;500;700" onload="this.rel='stylesheet'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Base Styles -->
    <style type="text/css">
        <?!= include('styles'); ?>
        /* Include base styles inline for GAS compatibility */
        :root {
            --color-primary: #3b82f6;
            --color-primary-hover: #2563eb;
            --color-secondary: #6b7280;
            --color-secondary-hover: #4b5563;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --transition: all 0.2s ease-in-out;
            --font-primary: 'Noto Sans', sans-serif;
            --font-secondary: 'Spline Sans', sans-serif;
        }

        .btn {
            @apply inline-flex items-center px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2;
        }

        .btn-primary {
            @apply bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500;
        }

        .btn-secondary {
            @apply bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500;
        }

        .btn-outline {
            @apply border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:ring-blue-500;
        }

        .btn-success {
            @apply bg-green-600 text-white hover:bg-green-700 focus:ring-green-500;
        }

        .btn-warning {
            @apply bg-yellow-600 text-white hover:bg-yellow-700 focus:ring-yellow-500;
        }

        .btn-danger {
            @apply bg-red-600 text-white hover:bg-red-700 focus:ring-red-500;
        }

        .project-card {
            @apply bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200 cursor-pointer;
        }

        .project-card:hover {
            transform: translateY(-2px);
        }

        .project-thumbnail {
            @apply w-full h-32 object-cover rounded-t-lg;
        }

        .status-badge {
            @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
        }

        .status-draft {
            @apply bg-yellow-100 text-yellow-800;
        }

        .status-published {
            @apply bg-green-100 text-green-800;
        }

        .status-archived {
            @apply bg-gray-100 text-gray-800;
        }

        .form-input {
            @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent;
        }

        .form-label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }

        .dropdown-menu {
            @apply absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-10 py-1;
        }

        .dropdown-item {
            @apply block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer;
        }

        .stats-card {
            @apply bg-white p-6 rounded-lg shadow-sm border border-gray-200;
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
    </style>
</head>
<body class="bg-[var(--bg-primary)] font-primary">
    <!-- Application Container -->
    <div id="app" class="app-container min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-6">
                    <div class="flex items-center">
                        <h1 class="text-3xl font-bold text-gray-900">Explico Learning</h1>
                        <div class="ml-4 flex items-center">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                Dashboard
                            </span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2 text-sm text-gray-600">
                            <span class="material-symbols-outlined text-sm">account_circle</span>
                            <span id="user-email">user@example.com</span>
                        </div>
                        <button id="new-project-btn" class="btn btn-primary">
                            <span class="material-symbols-outlined text-sm">add</span>
                            New Project
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="stats-card">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <span class="material-symbols-outlined text-2xl text-blue-600">folder</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Projects</p>
                            <p id="total-projects" class="text-2xl font-bold text-gray-900">3</p>
                        </div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <span class="material-symbols-outlined text-2xl text-green-600">slideshow</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Slides</p>
                            <p id="total-slides" class="text-2xl font-bold text-gray-900">12</p>
                        </div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <span class="material-symbols-outlined text-2xl text-purple-600">radio_button_checked</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Hotspots</p>
                            <p id="total-hotspots" class="text-2xl font-bold text-gray-900">28</p>
                        </div>
                    </div>
                </div>
                
                <div class="stats-card">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <span class="material-symbols-outlined text-2xl text-orange-600">schedule</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Last Updated</p>
                            <p id="last-updated" class="text-sm font-semibold text-gray-900">Today</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter Bar -->
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <span class="material-symbols-outlined absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm">search</span>
                            <input 
                                type="text" 
                                id="search-projects" 
                                placeholder="Search projects..." 
                                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            >
                        </div>
                        <select id="filter-status" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">All Projects</option>
                            <option value="draft">Draft</option>
                            <option value="published">Published</option>
                            <option value="archived">Archived</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="sort-btn" class="btn btn-outline">
                            <span class="material-symbols-outlined text-sm">sort</span>
                            Sort
                        </button>
                        <button id="refresh-btn" class="btn btn-outline">
                            <span class="material-symbols-outlined text-sm">refresh</span>
                            Refresh
                        </button>
                    </div>
                </div>
            </div>

            <!-- Projects Grid -->
            <div id="projects-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Project cards will be dynamically populated -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="text-center py-12 hidden">
                <div class="mx-auto h-24 w-24 text-gray-400">
                    <span class="material-symbols-outlined text-6xl">folder_open</span>
                </div>
                <h3 class="mt-4 text-lg font-medium text-gray-900">No projects found</h3>
                <p class="mt-2 text-sm text-gray-500">Get started by creating your first walkthrough project.</p>
                <button id="empty-new-project-btn" class="mt-4 btn btn-primary">
                    <span class="material-symbols-outlined text-sm">add</span>
                    Create New Project
                </button>
            </div>

            <!-- Loading State -->
            <div id="loading-state" class="text-center py-12 hidden">
                <div class="mx-auto h-8 w-8 animate-spin text-blue-600">
                    <span class="material-symbols-outlined text-2xl">refresh</span>
                </div>
                <p class="mt-2 text-sm text-gray-500">Loading projects...</p>
            </div>
        </main>
    </div>

    <!-- New Project Modal -->
    <div id="new-project-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Create New Project</h3>
            </div>
            <form id="new-project-form" class="px-6 py-4 space-y-4">
                <div>
                    <label for="project-name" class="form-label">Project Name</label>
                    <input 
                        type="text" 
                        id="project-name" 
                        name="projectName"
                        class="form-input"
                        placeholder="Enter project name..."
                        required
                    >
                </div>
                <div>
                    <label for="project-description" class="form-label">Description (Optional)</label>
                    <textarea 
                        id="project-description" 
                        name="projectDescription"
                        rows="3"
                        class="form-input"
                        placeholder="Brief description of your walkthrough..."
                    ></textarea>
                </div>
            </form>
            <div class="px-6 py-4 bg-gray-50 flex justify-end space-x-3 rounded-b-lg">
                <button id="cancel-new-project" class="btn btn-outline">Cancel</button>
                <button id="create-new-project" class="btn btn-primary">Create Project</button>
            </div>
        </div>
    </div>

    <!-- Project Actions Menu -->
    <div id="project-actions-menu" class="dropdown-menu hidden">
        <div class="dropdown-item" onclick="editProject()">
            <span class="material-symbols-outlined text-sm mr-2">edit</span>
            Edit Project
        </div>
        <div class="dropdown-item" onclick="duplicateProject()">
            <span class="material-symbols-outlined text-sm mr-2">content_copy</span>
            Duplicate
        </div>
        <div class="dropdown-item" onclick="exportProject()">
            <span class="material-symbols-outlined text-sm mr-2">download</span>
            Export
        </div>
        <div class="dropdown-item text-red-600" onclick="deleteProject()">
            <span class="material-symbols-outlined text-sm mr-2">delete</span>
            Delete
        </div>
    </div>
    
    <!-- Core Constants -->
    <script>
        const CONSTANTS = <?!= CONSTANTS ?>;
    </script>
    
    <!-- Utility Components -->
    <?!= include('FormControls'); ?>
    <?!= include('StatusBadge'); ?>
    <?!= include('ProgressBar'); ?>
    <?!= include('ProjectDashboard'); ?>
    
    <!-- Business Logic Services -->
    <?!= include('GoogleSheetsAPI'); ?>
    <?!= include('ProjectManager'); ?>
    
    <!-- Application Initialization -->
    <script>
        // Global app state
        window.ExplicoApp = {
            initialized: false,
            projects: [],
            filteredProjects: [],
            selectedProject: null
        };
        
        // Sample project data for demo
        const sampleProjects = [
            {
                id: 'project-1',
                name: 'Welcome Onboarding',
                description: 'New user introduction walkthrough',
                status: 'published',
                thumbnail: 'https://placehold.co/400x200/3B82F6/FFFFFF?text=Welcome+Onboarding',
                createdAt: '2024-01-15T10:00:00Z',
                updatedAt: '2024-01-20T14:30:00Z',
                slideCount: 5,
                hotspotCount: 12,
                viewCount: 145
            },
            {
                id: 'project-2',
                name: 'Feature Tour',
                description: 'Comprehensive feature walkthrough',
                status: 'draft',
                thumbnail: 'https://placehold.co/400x200/10B981/FFFFFF?text=Feature+Tour',
                createdAt: '2024-01-10T09:00:00Z',
                updatedAt: '2024-01-18T16:45:00Z',
                slideCount: 4,
                hotspotCount: 8,
                viewCount: 0
            },
            {
                id: 'project-3',
                name: 'Advanced Settings',
                description: 'Power user configuration guide',
                status: 'published',
                thumbnail: 'https://placehold.co/400x200/F59E0B/FFFFFF?text=Advanced+Settings',
                createdAt: '2024-01-05T11:00:00Z',
                updatedAt: '2024-01-15T13:20:00Z',
                slideCount: 3,
                hotspotCount: 8,
                viewCount: 89
            }
        ];

        // Load projects from Google Sheets
        async function loadProjects() {
            try {
                document.getElementById('loading-state').classList.remove('hidden');
                document.getElementById('empty-state').classList.add('hidden');
                
                // Use Google Apps Script function to get user projects
                const projects = await new Promise((resolve, reject) => {
                    google.script.run
                        .withSuccessHandler(resolve)
                        .withFailureHandler(reject)
                        .getUserProjects();
                });
                
                window.ExplicoApp.projects = projects;
                window.ExplicoApp.filteredProjects = projects;
                
                if (projects.length === 0) {
                    document.getElementById('empty-state').classList.remove('hidden');
                    document.getElementById('projects-container').classList.add('hidden');
                } else {
                    document.getElementById('empty-state').classList.add('hidden');
                    document.getElementById('projects-container').classList.remove('hidden');
                    renderProjects(projects);
                }
                
                // Update stats
                updateDashboardStats(projects);
                
            } catch (error) {
                console.error('Error loading projects:', error);
                showError('Failed to load projects: ' + error.message);
            } finally {
                document.getElementById('loading-state').classList.add('hidden');
            }
        }
        
        // Initialize dashboard application
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                console.log('Initializing Project Dashboard...');
                
                // Load projects from Google Sheets
                await loadProjects();
                
                // Setup event listeners
                setupEventListeners();
                
                window.ExplicoApp.initialized = true;
                console.log('Dashboard initialized successfully');
                
            } catch (error) {
                console.error('Failed to initialize dashboard:', error);
                showError('Failed to initialize dashboard: ' + error.message);
            }
        });

        // Render projects grid
        function renderProjects(projects) {
            const container = document.getElementById('projects-container');
            const emptyState = document.getElementById('empty-state');
            
            if (projects.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            container.innerHTML = projects.map(project => `
                <div class="project-card" onclick="openProject('${project.id}')">
                    <div class="relative">
                        <img src="${project.thumbnail}" alt="${project.name}" class="project-thumbnail">
                        <div class="absolute top-2 left-2">
                            <span class="status-badge status-${project.status}">${project.status.charAt(0).toUpperCase() + project.status.slice(1)}</span>
                        </div>
                        <div class="absolute top-2 right-2">
                            <button 
                                class="bg-white bg-opacity-80 hover:bg-opacity-100 p-1 rounded-full transition-all duration-200"
                                onclick="event.stopPropagation(); showProjectActions('${project.id}', event)"
                            >
                                <span class="material-symbols-outlined text-gray-600 text-sm">more_vert</span>
                            </button>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="flex items-start justify-between mb-2">
                            <h3 class="text-lg font-semibold text-gray-900 truncate pr-2">${project.name}</h3>
                        </div>
                        <p class="text-sm text-gray-600 mb-3 line-clamp-2">${project.description || 'No description'}</p>
                        <div class="flex items-center justify-between text-xs text-gray-500">
                            <div class="flex items-center space-x-3">
                                <span class="flex items-center">
                                    <span class="material-symbols-outlined text-xs mr-1">slideshow</span>
                                    ${project.slideCount} slides
                                </span>
                                <span class="flex items-center">
                                    <span class="material-symbols-outlined text-xs mr-1">radio_button_checked</span>
                                    ${project.hotspotCount} hotspots
                                </span>
                            </div>
                            <span>${formatDate(project.updatedAt)}</span>
                        </div>
                        ${project.status === 'published' ? `
                            <div class="mt-2 pt-2 border-t border-gray-100">
                                <span class="text-xs text-gray-500 flex items-center">
                                    <span class="material-symbols-outlined text-xs mr-1">visibility</span>
                                    ${project.viewCount} views
                                </span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Setup event listeners
        function setupEventListeners() {
            // New project buttons
            document.getElementById('new-project-btn').addEventListener('click', showNewProjectModal);
            document.getElementById('empty-new-project-btn').addEventListener('click', showNewProjectModal);
            
            // Modal controls
            document.getElementById('cancel-new-project').addEventListener('click', hideNewProjectModal);
            document.getElementById('create-new-project').addEventListener('click', handleCreateProject);
            
            // Close modal on overlay click
            document.getElementById('new-project-modal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('new-project-modal')) {
                    hideNewProjectModal();
                }
            });
            
            // Search and filter
            document.getElementById('search-projects').addEventListener('input', handleSearch);
            document.getElementById('filter-status').addEventListener('change', handleFilter);
            document.getElementById('refresh-btn').addEventListener('click', refreshProjects);
            
            // Form submission
            document.getElementById('new-project-form').addEventListener('submit', (e) => {
                e.preventDefault();
                handleCreateProject();
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#project-actions-menu')) {
                    hideProjectActions();
                }
            });
        }

        // Show new project modal
        function showNewProjectModal() {
            document.getElementById('new-project-modal').classList.remove('hidden');
            document.getElementById('new-project-modal').classList.add('flex');
            document.getElementById('project-name').focus();
        }

        // Hide new project modal
        function hideNewProjectModal() {
            document.getElementById('new-project-modal').classList.add('hidden');
            document.getElementById('new-project-modal').classList.remove('flex');
            document.getElementById('new-project-form').reset();
        }

        // Handle project creation
        async function handleCreateProject() {
            const form = document.getElementById('new-project-form');
            const formData = new FormData(form);
            
            const projectName = formData.get('projectName').trim();
            const projectDescription = formData.get('projectDescription').trim();
            
            if (!projectName) {
                alert('Please enter a project name');
                return;
            }
            
            const btn = document.getElementById('create-new-project');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.textContent = 'Creating...';
            
            // Use Google Apps Script to create project
            try {
                const newProject = await new Promise((resolve, reject) => {
                    google.script.run
                        .withSuccessHandler(resolve)
                        .withFailureHandler(reject)
                        .createNewProject({
                            name: projectName,
                            description: projectDescription
                        });
                });
                
                hideNewProjectModal();
                
                // Navigate to editor with the new project
                window.open(`?page=editor&project=${newProject.id}`, '_self');
                
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Failed to create project: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }

        // Open project for editing
        function openProject(projectId) {
            console.log('Opening project:', projectId);
            window.open(`?page=editor&project=${projectId}`, '_self');
        }

        // Show project actions menu
        function showProjectActions(projectId, event) {
            event.preventDefault();
            event.stopPropagation();
            
            const menu = document.getElementById('project-actions-menu');
            const rect = event.target.getBoundingClientRect();
            
            window.ExplicoApp.selectedProject = projectId;
            
            menu.style.top = (rect.bottom + window.scrollY) + 'px';
            menu.style.left = (rect.left - 150) + 'px';
            menu.classList.remove('hidden');
        }

        // Hide project actions menu
        function hideProjectActions() {
            document.getElementById('project-actions-menu').classList.add('hidden');
            window.ExplicoApp.selectedProject = null;
        }

        // Edit project metadata
        function editProject() {
            const projectId = window.ExplicoApp.selectedProject;
            if (!projectId) return;
            
            const project = window.ExplicoApp.projects.find(p => p.id === projectId);
            if (!project) return;
            
            const newName = prompt('Enter new project name:', project.name);
            if (newName && newName.trim() !== project.name) {
                project.name = newName.trim();
                project.updatedAt = new Date().toISOString();
                renderProjects(window.ExplicoApp.filteredProjects);
            }
            
            hideProjectActions();
        }

        // Duplicate project
        function duplicateProject() {
            const projectId = window.ExplicoApp.selectedProject;
            if (!projectId) return;
            
            const project = window.ExplicoApp.projects.find(p => p.id === projectId);
            if (!project) return;
            
            const duplicatedProject = {
                ...project,
                id: 'project-' + Date.now(),
                name: project.name + ' (Copy)',
                status: 'draft',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                viewCount: 0
            };
            
            window.ExplicoApp.projects.unshift(duplicatedProject);
            window.ExplicoApp.filteredProjects = [...window.ExplicoApp.projects];
            
            renderProjects(window.ExplicoApp.filteredProjects);
            updateDashboardStats(window.ExplicoApp.projects);
            
            hideProjectActions();
        }

        // Export project
        function exportProject() {
            const projectId = window.ExplicoApp.selectedProject;
            if (!projectId) return;
            
            alert('Export functionality will download the project as a JSON file');
            hideProjectActions();
        }

        // Delete project
        function deleteProject() {
            const projectId = window.ExplicoApp.selectedProject;
            if (!projectId) return;
            
            const project = window.ExplicoApp.projects.find(p => p.id === projectId);
            if (!project) return;
            
            if (confirm(`Are you sure you want to delete "${project.name}"? This action cannot be undone.`)) {
                window.ExplicoApp.projects = window.ExplicoApp.projects.filter(p => p.id !== projectId);
                window.ExplicoApp.filteredProjects = window.ExplicoApp.filteredProjects.filter(p => p.id !== projectId);
                
                renderProjects(window.ExplicoApp.filteredProjects);
                updateDashboardStats(window.ExplicoApp.projects);
            }
            
            hideProjectActions();
        }

        // Handle search
        function handleSearch() {
            filterProjects();
        }

        // Handle status filter
        function handleFilter() {
            filterProjects();
        }

        // Filter projects
        function filterProjects() {
            const query = document.getElementById('search-projects').value.toLowerCase();
            const status = document.getElementById('filter-status').value;
            
            let filtered = window.ExplicoApp.projects;
            
            if (query) {
                filtered = filtered.filter(project => 
                    project.name.toLowerCase().includes(query) ||
                    (project.description && project.description.toLowerCase().includes(query))
                );
            }
            
            if (status) {
                filtered = filtered.filter(project => project.status === status);
            }
            
            window.ExplicoApp.filteredProjects = filtered;
            renderProjects(filtered);
        }

        // Refresh projects
        function refreshProjects() {
            const btn = document.getElementById('refresh-btn');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<span class="material-symbols-outlined text-sm animate-spin">refresh</span> Refreshing...';
            btn.disabled = true;
            
            // Simulate refresh delay
            setTimeout(() => {
                renderProjects(window.ExplicoApp.filteredProjects);
                updateDashboardStats(window.ExplicoApp.projects);
                
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 1000);
        }

        // Update dashboard statistics
        function updateDashboardStats(projects) {
            const totalProjects = projects.length;
            const totalSlides = projects.reduce((sum, project) => sum + project.slideCount, 0);
            const totalHotspots = projects.reduce((sum, project) => sum + project.hotspotCount, 0);
            
            const lastUpdated = projects.length > 0 
                ? new Date(Math.max(...projects.map(p => new Date(p.updatedAt)))).toLocaleDateString()
                : 'N/A';
            
            document.getElementById('total-projects').textContent = totalProjects;
            document.getElementById('total-slides').textContent = totalSlides;
            document.getElementById('total-hotspots').textContent = totalHotspots;
            document.getElementById('last-updated').textContent = lastUpdated === new Date().toLocaleDateString() ? 'Today' : lastUpdated;
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) return 'Today';
            if (diffDays <= 7) return `${diffDays} days ago`;
            if (diffDays <= 30) return `${Math.ceil(diffDays / 7)} weeks ago`;
            return date.toLocaleDateString();
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded shadow-lg z-50';
            errorDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="material-symbols-outlined text-sm mr-2">error</span>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-red-500 hover:text-red-700">
                        <span class="material-symbols-outlined text-sm">close</span>
                    </button>
                </div>
            `;
            document.body.appendChild(errorDiv);

            setTimeout(() => {
                if (errorDiv.parentElement) {
                    errorDiv.remove();
                }
            }, 5000);
        }

        // Show success message
        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded shadow-lg z-50';
            successDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="material-symbols-outlined text-sm mr-2">check_circle</span>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-green-500 hover:text-green-700">
                        <span class="material-symbols-outlined text-sm">close</span>
                    </button>
                </div>
            `;
            document.body.appendChild(successDiv);

            setTimeout(() => {
                if (successDiv.parentElement) {
                    successDiv.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>