<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explico Learning - Interactive Walkthroughs</title>
    
    <!-- Preconnect to external services -->
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    
    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Spline+Sans:wght@400;500;700" onload="this.rel='stylesheet'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Base Styles -->
    <style type="text/css">
        /* Ensure CSS variables are loaded first with fallbacks */
        :root {
            /* Fallback CSS variables in case styles.html doesn't load */
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --brand-primary: #2d3f89;
            --brand-primary-hover: #3c52b2;
            --brand-green: #2dd67e;
            --brand-red: #ad2122;
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-6: 1.5rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-full: 9999px;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --transition-normal: 200ms ease;
            --z-dropdown: 1000;
        }
        
        <?!= include('styles'); ?>
        /* Additional styles for main application */

        /* View Management Styles */
        .app-view {
            display: none;
            width: 100%;
            height: 100vh;
            overflow: auto;
        }
        
        .app-view.active {
            display: block;
        }
        
        /* Smooth transitions for view switching */
        .app-view {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        
        .app-view.active {
            opacity: 1;
        }

        /* Component styles from both dashboard and editor */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all var(--transition-normal);
            border: 1px solid transparent;
        }

        .btn-primary {
            background: var(--brand-primary);
            color: var(--text-primary);
        }

        .btn-primary:hover {
            background: var(--brand-primary-hover);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-color: var(--gray-600);
        }

        .btn-secondary:hover {
            background: var(--gray-600);
            color: var(--text-primary);
        }

        .btn-outline {
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-color: var(--gray-600);
        }

        .btn-outline:hover {
            background: var(--gray-600);
            color: var(--text-primary);
        }

        .btn-success {
            background: var(--brand-green);
            color: var(--text-primary);
        }

        .btn-warning {
            background: var(--brand-red);
            color: var(--text-primary);
        }

        .btn-danger {
            background: var(--brand-red);
            color: var(--text-primary);
        }

        .project-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .project-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .project-thumbnail {
            width: 100%;
            height: 8rem;
            object-fit: cover;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-draft {
            background: rgba(245, 158, 11, 0.1);
            color: var(--text-primary);
        }

        .status-published {
            background: rgba(45, 214, 126, 0.1);
            color: var(--brand-green);
        }

        .status-archived {
            background: rgba(156, 163, 175, 0.1);
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--gray-600);
            border-radius: var(--radius-lg);
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: border-color var(--transition-normal);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--brand-primary);
            box-shadow: 0 0 0 3px rgba(45, 63, 137, 0.1);
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: var(--space-1);
        }

        /* Editor specific styles */
        .hotspot {
            position: absolute;
            width: 32px;
            height: 32px;
            background: rgba(59, 130, 246, 0.8);
            border: 2px solid #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
            transition: all 0.2s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hotspot:hover {
            background: rgba(59, 130, 246, 1);
            transform: translate(-50%, -50%) scale(1.1);
        }

        .hotspot.selected {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.8);
        }

        .canvas-container {
            position: relative;
            overflow: hidden;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .canvas-background {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .sidebar {
            height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .config-panel {
            height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .slide-thumbnail {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .slide-thumbnail.active {
            border-color: #3b82f6;
        }

        /* Loading view styles */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--gray-600);
            border-top: 4px solid var(--brand-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--space-4);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error view styles */
        .error-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
            padding: var(--space-6);
        }

        .error-icon {
            font-size: 4rem;
            color: var(--brand-red);
            margin-bottom: var(--space-4);
        }
    </style>
</head>
<body class="font-primary" style="background-color: var(--bg-primary);">
    <!-- Main Application Container -->
    <div id="main-app" class="min-h-screen">
        
        <!-- Loading View -->
        <div id="loading-view" class="app-view active">
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <h2 class="text-xl font-semibold text-primary mb-2">Loading Explico Learning</h2>
                <p class="text-secondary" id="loading-message">Initializing application...</p>
            </div>
        </div>

        <!-- Error View -->
        <div id="error-view" class="app-view">
            <div class="error-container">
                <span class="material-symbols-outlined error-icon">error</span>
                <h2 class="text-2xl font-bold text-primary mb-4">Something went wrong</h2>
                <p class="text-secondary mb-6" id="error-message">An unexpected error occurred.</p>
                <div class="space-x-4">
                    <button id="retry-btn" class="btn btn-primary">
                        <span class="material-symbols-outlined text-sm">refresh</span>
                        Retry
                    </button>
                    <button id="refresh-btn" class="btn btn-outline">
                        <span class="material-symbols-outlined text-sm">home</span>
                        Refresh Page
                    </button>
                </div>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="app-view">
            <!-- Dashboard Header -->
            <header class="bg-white shadow-sm border-b border-gray-200">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center py-6">
                        <div class="flex items-center">
                            <h1 class="text-3xl font-bold text-gray-900">Explico Learning</h1>
                            <span class="ml-4 inline-flex items-center px-3 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                Dashboard
                            </span>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button id="create-project-btn" class="btn btn-primary">
                                <span class="material-symbols-outlined text-sm">add</span>
                                Create Project
                            </button>
                            <button id="user-menu-btn" class="btn btn-outline">
                                <span class="material-symbols-outlined text-sm">account_circle</span>
                                <span id="user-email">Loading...</span>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Dashboard Content -->
            <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <!-- Stats Cards -->
                <div id="stats-section" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="stats-card">
                        <div class="flex items-center">
                            <span class="material-symbols-outlined text-blue-600 text-2xl mr-4">folder</span>
                            <div>
                                <p class="text-2xl font-bold text-primary" id="total-projects">-</p>
                                <p class="text-sm text-secondary">Total Projects</p>
                            </div>
                        </div>
                    </div>
                    <div class="stats-card">
                        <div class="flex items-center">
                            <span class="material-symbols-outlined text-green-600 text-2xl mr-4">publish</span>
                            <div>
                                <p class="text-2xl font-bold text-primary" id="published-projects">-</p>
                                <p class="text-sm text-secondary">Published</p>
                            </div>
                        </div>
                    </div>
                    <div class="stats-card">
                        <div class="flex items-center">
                            <span class="material-symbols-outlined text-orange-600 text-2xl mr-4">edit</span>
                            <div>
                                <p class="text-2xl font-bold text-primary" id="draft-projects">-</p>
                                <p class="text-sm text-secondary">Drafts</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Projects Grid -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-semibold text-primary">Your Projects</h2>
                        <div class="flex items-center space-x-4">
                            <select id="sort-projects" class="form-input w-auto">
                                <option value="updated">Last Updated</option>
                                <option value="created">Date Created</option>
                                <option value="name">Name</option>
                                <option value="status">Status</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="projects-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <!-- Projects will be dynamically loaded here -->
                    </div>
                    
                    <div id="no-projects" class="text-center py-12 hidden">
                        <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">folder_open</span>
                        <h3 class="text-lg font-medium text-primary mb-2">No projects yet</h3>
                        <p class="text-secondary mb-4">Create your first interactive walkthrough project to get started.</p>
                        <button onclick="ViewManager.showCreateProject()" class="btn btn-primary">
                            <span class="material-symbols-outlined text-sm">add</span>
                            Create Your First Project
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Editor View -->
        <div id="editor-view" class="app-view">
            <!-- Editor Header -->
            <header id="editor-header" class="flex-shrink-0 bg-white shadow-sm border-b border-gray-200">
                <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between items-center py-4">
                        <div class="flex items-center">
                            <button id="back-to-dashboard-btn" class="btn btn-outline mr-4">
                                <span class="material-symbols-outlined text-sm">arrow_back</span>
                                Dashboard
                            </button>
                            <h1 id="project-title" class="text-2xl font-bold text-gray-900">Project Editor</h1>
                            <div class="ml-4 flex items-center space-x-2">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    Editor
                                </span>
                                <span id="project-status" class="status-badge status-draft">Draft</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <button id="save-btn" class="btn btn-primary">
                                <span class="material-symbols-outlined text-sm">save</span>
                                Save Project
                            </button>
                            <button id="preview-btn" class="btn btn-secondary">
                                <span class="material-symbols-outlined text-sm">play_arrow</span>
                                Preview
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Editor Content -->
            <div class="flex-1 flex overflow-hidden">
                <!-- Sidebar -->
                <aside id="editor-sidebar" class="w-80 bg-white border-r border-gray-200 flex-shrink-0 sidebar">
                    <div class="p-4 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">Slides</h3>
                            <button id="add-slide-btn" class="btn btn-primary text-sm py-1 px-2">
                                <span class="material-symbols-outlined text-xs">add</span>
                                Add Slide
                            </button>
                        </div>
                    </div>
                    <div id="slides-list" class="p-4 space-y-3">
                        <!-- Slides will be dynamically populated -->
                    </div>
                </aside>

                <!-- Main Canvas -->
                <main class="flex-1 flex overflow-hidden">
                    <!-- Canvas Area -->
                    <div class="flex-1 p-4">
                        <div class="h-full flex flex-col">
                            <div class="flex items-center justify-between mb-4">
                                <h3 id="current-slide-title" class="text-lg font-semibold text-gray-900">Select a slide to begin editing</h3>
                                <div class="flex items-center space-x-2">
                                    <button id="toggle-creation-mode" class="btn btn-outline text-sm">
                                        <span class="material-symbols-outlined text-xs">add_circle</span>
                                        Creation Mode
                                    </button>
                                    <select id="zoom-level" class="border border-gray-300 rounded px-2 py-1 text-sm">
                                        <option value="0.5">50%</option>
                                        <option value="0.75">75%</option>
                                        <option value="1" selected>100%</option>
                                        <option value="1.25">125%</option>
                                        <option value="1.5">150%</option>
                                    </select>
                                </div>
                            </div>
                            <div id="canvas-container" class="flex-1 canvas-container">
                                <div id="canvas-empty-state" class="h-full flex items-center justify-center text-gray-500">
                                    <div class="text-center">
                                        <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">image</span>
                                        <p class="text-lg">Select a slide or add a new one to start editing</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Config Panel -->
                    <aside id="config-panel" class="w-96 bg-white border-l border-gray-200 flex-shrink-0 config-panel hidden">
                        <div class="p-4 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-semibold text-gray-900">Hotspot Configuration</h3>
                                <button id="close-config-panel" class="text-gray-400 hover:text-gray-600">
                                    <span class="material-symbols-outlined">close</span>
                                </button>
                            </div>
                        </div>
                        <div id="config-form" class="p-4">
                            <!-- Configuration form will be dynamically populated -->
                        </div>
                    </aside>
                </main>
            </div>

            <!-- Bottom Timeline/Sequencer -->
            <div id="sequencer-container" class="h-32 bg-white border-t border-gray-200 flex-shrink-0">
                <div class="p-4 h-full">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-semibold text-gray-900">Hotspot Sequence</h3>
                        <div class="text-xs text-gray-500" id="sequence-info">
                            No hotspots on current slide
                        </div>
                    </div>
                    <div id="hotspots-sequence" class="flex space-x-2 overflow-x-auto h-20">
                        <!-- Hotspot sequence items will be dynamically populated -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Core Constants -->
    <script>
        // Initialize constants with error handling
        let CONSTANTS;
        try {
            CONSTANTS = <?!= CONSTANTS ?>;
            console.log('✅ Constants loaded successfully:', Object.keys(CONSTANTS || {}).length, 'categories');
        } catch (error) {
            console.error('❌ Failed to load constants:', error);
            CONSTANTS = {
                EVENT_TYPES: { TEXT_POPUP: 'text_popup', TEXT_ON_IMAGE: 'text_on_image' },
                TRIGGER_TYPES: { CLICK: 'click', HOVER: 'hover' },
                PROJECT_STATUS: { DRAFT: 'draft', PUBLISHED: 'published' }
            };
            console.log('📄 Using fallback constants');
        }
        
        // Validate essential constants
        if (!CONSTANTS || typeof CONSTANTS !== 'object') {
            console.error('❌ Constants validation failed, using minimal fallback');
            CONSTANTS = { EVENT_TYPES: {}, TRIGGER_TYPES: {}, PROJECT_STATUS: {} };
        }
    </script>

    <!-- ViewManager and Application Logic -->
    <script>
        // View Manager - handles all view switching and state management
        class ViewManager {
            static currentView = 'loading';
            static currentProject = null;
            static appState = {
                initialized: false,
                projects: {},
                slides: {},
                hotspots: {},
                selectedHotspot: null,
                creationMode: false
            };

            // Show a specific view
            static showView(viewName, data = {}) {
                console.log(`🔄 Switching to view: ${viewName}`, data);
                
                // Hide all views
                const views = document.querySelectorAll('.app-view');
                views.forEach(view => {
                    view.classList.remove('active');
                });
                
                // Show target view
                const targetView = document.getElementById(`${viewName}-view`);
                if (targetView) {
                    targetView.classList.add('active');
                    this.currentView = viewName;
                    
                    // Handle view-specific logic
                    switch(viewName) {
                        case 'dashboard':
                            this.initializeDashboard(data);
                            break;
                        case 'editor':
                            this.initializeEditor(data);
                            break;
                        case 'loading':
                            this.updateLoadingMessage(data.message || 'Loading...');
                            break;
                        case 'error':
                            this.showError(data.message || 'An error occurred', data.details);
                            break;
                    }
                } else {
                    console.error('❌ View not found:', viewName);
                }
            }

            // Initialize dashboard view
            static async initializeDashboard(data = {}) {
                console.log('🏠 Initializing Dashboard view');
                
                try {
                    // Load user info
                    await this.loadUserInfo();
                    
                    // Load projects
                    await this.loadProjects();
                    
                    console.log('✅ Dashboard initialized successfully');
                } catch (error) {
                    console.error('❌ Dashboard initialization failed:', error);
                    this.showView('error', {
                        message: 'Failed to load dashboard',
                        details: error.message
                    });
                }
            }

            // Initialize editor view
            static async initializeEditor(data = {}) {
                console.log('🎨 Initializing Editor view', data);
                
                if (!data.projectId) {
                    this.showView('error', {
                        message: 'No project selected',
                        details: 'Please select a project from the dashboard'
                    });
                    return;
                }

                try {
                    this.currentProject = data.projectId;
                    
                    // Load project data
                    await this.loadProjectData(data.projectId);
                    
                    console.log('✅ Editor initialized successfully');
                } catch (error) {
                    console.error('❌ Editor initialization failed:', error);
                    this.showView('error', {
                        message: 'Failed to load project editor',
                        details: error.message
                    });
                }
            }

            // Load user information
            static async loadUserInfo() {
                return new Promise((resolve, reject) => {
                    if (typeof google === 'undefined' || !google.script) {
                        // Fallback for testing
                        document.getElementById('user-email').textContent = 'user@example.com';
                        resolve();
                        return;
                    }

                    google.script.run
                        .withSuccessHandler(user => {
                            document.getElementById('user-email').textContent = user.email || 'Unknown User';
                            resolve();
                        })
                        .withFailureHandler(error => {
                            console.error('Failed to load user info:', error);
                            document.getElementById('user-email').textContent = 'User';
                            resolve(); // Don't fail the whole dashboard for this
                        })
                        .getCurrentUser();
                });
            }

            // Load projects list
            static async loadProjects() {
                return new Promise((resolve, reject) => {
                    if (typeof google === 'undefined' || !google.script) {
                        // Fallback for testing
                        this.renderProjects([]);
                        resolve();
                        return;
                    }

                    google.script.run
                        .withSuccessHandler(projects => {
                            console.log('📦 Loaded projects:', projects.length);
                            this.renderProjects(projects || []);
                            this.updateStats(projects || []);
                            resolve();
                        })
                        .withFailureHandler(error => {
                            console.error('Failed to load projects:', error);
                            reject(error);
                        })
                        .getUserProjects();
                });
            }

            // Load project data for editor
            static async loadProjectData(projectId) {
                return new Promise((resolve, reject) => {
                    if (typeof google === 'undefined' || !google.script) {
                        // Fallback for testing
                        const mockProject = {
                            id: projectId,
                            name: 'Test Project',
                            status: 'draft',
                            slides: []
                        };
                        this.renderProject(mockProject);
                        resolve();
                        return;
                    }

                    google.script.run
                        .withSuccessHandler(project => {
                            if (!project) {
                                reject(new Error('Project not found'));
                                return;
                            }
                            
                            console.log('📦 Loaded project data:', project);
                            this.renderProject(project);
                            resolve();
                        })
                        .withFailureHandler(error => {
                            console.error('Failed to load project data:', error);
                            reject(error);
                        })
                        .getProjectData(projectId);
                });
            }

            // Render projects in dashboard
            static renderProjects(projects) {
                const container = document.getElementById('projects-container');
                const noProjects = document.getElementById('no-projects');
                
                if (projects.length === 0) {
                    container.innerHTML = '';
                    noProjects.classList.remove('hidden');
                    return;
                }
                
                noProjects.classList.add('hidden');
                
                container.innerHTML = projects.map(project => `
                    <div class="project-card" onclick="ViewManager.openProject('${project.id}')">
                        <div class="relative">
                            <img src="${project.thumbnail || 'https://placehold.co/400x200/6B7280/FFFFFF?text=' + encodeURIComponent(project.name)}" 
                                 alt="${project.name}" class="project-thumbnail">
                            <div class="absolute top-2 right-2">
                                <span class="status-badge status-${project.status}">${project.status}</span>
                            </div>
                        </div>
                        <div class="p-4">
                            <h3 class="font-semibold text-primary mb-2 truncate">${project.name}</h3>
                            <p class="text-sm text-secondary mb-3 line-clamp-2">${project.description || 'No description'}</p>
                            <div class="flex items-center justify-between text-xs text-secondary">
                                <span>${project.slideCount || 0} slides</span>
                                <span>${project.hotspotCount || 0} hotspots</span>
                            </div>
                            <div class="mt-2 text-xs text-secondary">
                                Updated ${this.formatDate(project.updatedAt)}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // Update dashboard stats
            static updateStats(projects) {
                const total = projects.length;
                const published = projects.filter(p => p.status === 'published').length;
                const drafts = projects.filter(p => p.status === 'draft').length;
                
                document.getElementById('total-projects').textContent = total;
                document.getElementById('published-projects').textContent = published;
                document.getElementById('draft-projects').textContent = drafts;
            }

            // Render project in editor
            static renderProject(project) {
                this.appState.currentProject = project;
                
                // Update header
                document.getElementById('project-title').textContent = project.name;
                document.getElementById('project-status').textContent = project.status || 'draft';
                document.getElementById('project-status').className = `status-badge status-${project.status || 'draft'}`;
                
                // Load slides
                if (project.slides && project.slides.length > 0) {
                    this.renderSlides(project.slides);
                } else {
                    this.showEmptySlideState();
                }
            }

            // Render slides in editor sidebar
            static renderSlides(slides) {
                const slidesList = document.getElementById('slides-list');
                
                slidesList.innerHTML = slides.map(slide => `
                    <div class="slide-item p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50"
                         data-slide-id="${slide.id}" onclick="ViewManager.selectSlide('${slide.id}')">
                        <div class="flex items-center space-x-3">
                            <img src="${slide.backgroundUrl}" alt="${slide.name}" class="slide-thumbnail">
                            <div class="flex-1 min-w-0">
                                <h4 class="text-sm font-medium text-gray-900 truncate">${slide.name}</h4>
                                <p class="text-xs text-gray-500">${slide.backgroundType.toUpperCase()}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // Show empty slide state
            static showEmptySlideState() {
                const slidesList = document.getElementById('slides-list');
                slidesList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <span class="material-symbols-outlined text-4xl mb-2">slideshow</span>
                        <p>No slides yet</p>
                        <button onclick="ViewManager.showAddSlideModal()" class="btn btn-primary mt-2 text-sm">
                            Add First Slide
                        </button>
                    </div>
                `;
            }

            // Utility functions
            static formatDate(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 1) return 'Yesterday';
                if (diffDays < 7) return `${diffDays} days ago`;
                return date.toLocaleDateString();
            }

            static updateLoadingMessage(message) {
                document.getElementById('loading-message').textContent = message;
            }

            static showError(message, details) {
                document.getElementById('error-message').textContent = message;
                if (details) {
                    console.error('Error details:', details);
                }
            }

            // Navigation methods
            static openProject(projectId) {
                console.log('🚀 Opening project:', projectId);
                this.showView('editor', { projectId });
            }

            static goToDashboard() {
                console.log('🏠 Going to dashboard');
                this.showView('dashboard');
            }

            static selectSlide(slideId) {
                console.log('📄 Selecting slide:', slideId);
                // Implement slide selection logic
            }

            static showAddSlideModal() {
                console.log('➕ Show add slide modal');
                // Implement add slide modal
            }
        }

        // Global app initialization
        window.ExplicoApp = ViewManager;

        // Initialize application when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Initializing Explico Learning App...');
            
            // Setup event listeners
            setupEventListeners();
            
            // Start with dashboard
            setTimeout(() => {
                ViewManager.showView('dashboard');
            }, 1000);
        });

        // Setup all event listeners
        function setupEventListeners() {
            // Dashboard event listeners
            document.getElementById('create-project-btn')?.addEventListener('click', () => {
                console.log('Create project clicked');
                // Implement create project modal
            });

            // Editor event listeners  
            document.getElementById('back-to-dashboard-btn')?.addEventListener('click', () => {
                ViewManager.goToDashboard();
            });

            document.getElementById('save-btn')?.addEventListener('click', () => {
                console.log('Save project clicked');
                // Implement save functionality
            });

            document.getElementById('preview-btn')?.addEventListener('click', () => {
                console.log('Preview project clicked');
                // Implement preview functionality
            });

            document.getElementById('add-slide-btn')?.addEventListener('click', () => {
                ViewManager.showAddSlideModal();
            });

            // Error view event listeners
            document.getElementById('retry-btn')?.addEventListener('click', () => {
                ViewManager.showView('dashboard');
            });

            document.getElementById('refresh-btn')?.addEventListener('click', () => {
                location.reload();
            });

            console.log('✅ Event listeners setup complete');
        }

        // Show success message
        function showSuccess(message, duration = 4000) {
            console.log('✅ Success:', message);
            
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 max-w-md bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg shadow-lg z-50';
            successDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="material-symbols-outlined text-green-600 text-sm mr-3">check_circle</span>
                    <span class="text-sm">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-green-400 hover:text-green-600">
                        <span class="material-symbols-outlined text-sm">close</span>
                    </button>
                </div>
            `;
            
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                if (successDiv.parentElement) {
                    successDiv.style.transform = 'translateX(100%)';
                    setTimeout(() => successDiv.remove(), 300);
                }
            }, duration);
        }

        console.log('📱 Single-page application loaded successfully');
    </script>
</body>
</html>