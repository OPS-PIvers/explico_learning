# AGENTS.md

This file provides guidance to Google Jules AI asynch coding agent when working with code in this repository.

## Project Overview

Explico Learning is a modern TypeScript/React-based interactive walkthrough editor that compiles to Google Apps Script. It allows users to create hotspot-enabled presentations with background media (images, videos, YouTube). The app features a project dashboard and hotspot editor with real-time preview capabilities, all persisted to Google Sheets.

**Key Technologies:**
- **Frontend**: React 19 with TypeScript
- **Backend**: Google Apps Script (compiled from TypeScript)
- **Build**: Webpack + Babel
- **Testing**: Jest with React Testing Library
- **Linting**: ESLint + Prettier
- **Deployment**: Clasp (Google Apps Script CLI)

**Live URLs:**
- Web App: https://script.google.com/macros/s/AKfycbw9ZicNfjF7nSt_lCpYoI3MXEi_McVLAW3dzBClcTVz-QgsJ_nPDTRsQA0ELCK5fyde/exec
- Apps Script Editor: https://script.google.com/d/1YiQsdE97f3dM50Y26dgjqPUCjIIbMGWX5U2yVha8fu1264DtIj0VJWh_/edit

## Development Commands

### TypeScript Development Commands
```bash
# Build and type-check
npm run build
npm run type-check

# Development workflow
npm run dev  # Watch mode
npm run lint
npm run test

# Quality checks
npm run quality  # Run all checks

# Deployment
npm run deploy      # Production: quality + build + deploy
npm run deploy:dev  # Development: build + deploy (skip quality)
./build.sh          # Manual build
clasp push --force  # Manual push
```

### File Structure
- `src/` - TypeScript source code
  - `src/client/` - React components and client-side TypeScript
  - `src/server/` - Server-side TypeScript (compiles to Google Apps Script)
  - `src/shared/` - Shared types, constants, and utilities
- `dist/` - Built files ready for deployment (generated by webpack + build.sh)
- `services/` - Legacy JavaScript services (being migrated to TypeScript)
- `templates/` - HTML templates
- `package.json` - NPM dependencies and build scripts
- `webpack.config.js` - TypeScript compilation configuration
- `tsconfig.json` - TypeScript configuration
- `appsscript.json` - Google Apps Script project configuration
- `.clasp.json` - Deployment configuration (script ID, root dir)

## Architecture

### Modern TypeScript/React Architecture
The application follows a modern component-based architecture:

**Server-Side (`src/server/`):**
- `Code.ts` - Main entry point and routing (compiles to Code.gs)
- `constants.ts` - Application constants (compiles to constants.gs)
- `services/` - Server-side TypeScript services

**Client-Side React (`src/client/`):**
- `components/ProjectDashboard.tsx` - Project management
- `components/AppHeader.tsx` - Application header
- `components/MainCanvas.tsx` - Interactive canvas
- `components/ConfigPanel.tsx` - Configuration forms
- `components/HotspotEditor.tsx` - Hotspot editing
- `components/common/` - Reusable components

**Legacy Services (`services/` - being migrated):**
- `GoogleSheetsAPI.js` - Data persistence
- `HotspotManager.js` - Hotspot operations
- `EventTypeHandlers.js` - Event handling
- `MediaHandler.js` - Media processing
- `ProjectManager_server.js` - Server-side project logic
- `ProjectManager_client.js` - Client-side project logic

### Data Storage Structure
Each project creates a Google Spreadsheet with sheets:
- **Projects** - Project metadata, settings, analytics
- **Slides** - Slide data, media URLs, ordering  
- **Hotspots** - Complete hotspot configurations with positioning and events
- **Analytics** - User interaction tracking and metrics

### Page Routing
The main `Code.gs` file (compiled from `src/server/Code.ts`) handles routing:
- `/exec` (default) → `main-app.html` - React-based project dashboard
- `/exec?page=editor&project={id}` → `editor-template.html` - React-based hotspot editor

## Development Guidelines

### TypeScript Development
1. **Edit source**: Modify files in `src/`
2. **Type checking**: Run `npm run type-check`
3. **Build**: Run `npm run build` or `npm run build:dev`
4. **Test**: Run `npm run test`
5. **Deploy**: Use `npm run deploy` or `npm run deploy:dev`

### Adding New React Components
1. Create `.tsx` file in `src/client/components/`
2. Use TypeScript interfaces from `src/shared/types/`
3. Import constants from `src/shared/constants/`
4. Follow existing React patterns
5. Add proper error boundaries and loading states

### Adding New Hotspot Event Types
1. Add event type to `src/shared/constants/`
2. Update TypeScript interfaces in `src/shared/types/`
3. Implement handler in `EventTypeHandlers.js` (legacy, to migrate)
4. Add configuration in `ConfigPanel.tsx`
5. Test in React hotspot editor

### Migration from Legacy JavaScript
- **Services**: Gradually migrate `services/*.js` to `src/server/services/*.ts`
- **Client code**: Migrate to React components in `src/client/`
- **Shared code**: Move constants/types to `src/shared/`
- **Test thoroughly** after each migration

### Google Sheets Integration
- Each project gets its own spreadsheet for data isolation
- Use batch operations in `GoogleSheetsAPI.js` for performance
- Column mappings defined in `SHEETS_CONFIG` constants
- Relationship integrity maintained through service layer

## Deployment Notes

### Modern Deployment Workflow
- **Production**: `npm run deploy` (includes quality checks)
- **Development**: `npm run deploy:dev` (faster, skips quality checks)
- **Manual**: `./build.sh && clasp push --force`

### Quality Assurance
- TypeScript compilation must pass
- ESLint checks must pass
- Tests must pass (for production deployments)
- Manual testing recommended after deployment
