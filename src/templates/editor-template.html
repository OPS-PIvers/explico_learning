<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explico Learning - Hotspot Editor</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚úèÔ∏è</text></svg>">

    <!-- Meta tags -->
    <meta name="description" content="Interactive hotspot editor for creating engaging walkthrough experiences">
    <meta name="keywords" content="hotspot, editor, interactive, presentation, walkthrough">
    <meta name="author" content="Explico Learning">

    <!-- Prevent zoom on mobile inputs -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Editor styles will be injected by webpack -->
    <style>
        /* Critical CSS for loading state */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            overflow: hidden;
        }

        .initial-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            gap: 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #6c757d;
            font-size: 16px;
        }

        /* Hide initial loading when React takes over */
        .app-loaded .initial-loading {
            display: none;
        }

        /* Prevent text selection during hotspot creation */
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <!-- Project ID will be set by server -->
    <script>
        window.projectId = '<?= typeof projectId !== "undefined" ? projectId : "" ?>';
    </script>

    <!-- Initial loading state -->
    <div class="initial-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Hotspot Editor...</div>
    </div>

    <!-- React app will mount here -->
    <div id="app-root"></div>

    <!-- Error fallback -->
    <div id="error-fallback" style="display: none; padding: 40px; text-align: center; color: #721c24; background: #f8d7da; margin: 20px; border-radius: 4px;">
        <h2>üö´ Editor Error</h2>
        <p>Something went wrong loading the hotspot editor.</p>
        <div style="margin-top: 16px; display: flex; justify-content: center; gap: 12px;">
            <button onclick="window.location.reload()" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Reload Editor
            </button>
            <button onclick="window.history.back()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Go Back
            </button>
        </div>
    </div>

    <!-- Keyboard shortcuts help -->
    <div id="shortcuts-help" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 2000; max-width: 400px;">
        <h3 style="margin-top: 0;">Keyboard Shortcuts</h3>
        <ul style="list-style: none; padding: 0; margin: 0;">
            <li style="padding: 4px 0;"><kbd>Ctrl/Cmd + S</kbd> - Save project</li>
            <li style="padding: 4px 0;"><kbd>Delete</kbd> - Delete selected hotspot</li>
            <li style="padding: 4px 0;"><kbd>Esc</kbd> - Deselect hotspot</li>
            <li style="padding: 4px 0;"><kbd>?</kbd> - Show/hide shortcuts</li>
        </ul>
        <button onclick="document.getElementById('shortcuts-help').style.display='none'" style="margin-top: 16px; padding: 6px 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Close
        </button>
    </div>

    <!-- Google Apps Script API -->
    <script>
        // Initialize Google Apps Script client library
        window.addEventListener('error', function(e) {
            console.error('Editor error:', e.error);
            document.getElementById('error-fallback').style.display = 'block';
            document.querySelector('.initial-loading').style.display = 'none';
        });

        // Hide loading screen when app is ready
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (document.getElementById('app-root').children.length > 0) {
                    document.body.classList.add('app-loaded');
                }
            }, 100);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Show shortcuts help
            if (e.key === '?' && !e.ctrlKey && !e.metaKey && !e.altKey) {
                const help = document.getElementById('shortcuts-help');
                help.style.display = help.style.display === 'none' ? 'block' : 'none';
            }

            // Hide shortcuts help
            if (e.key === 'Escape') {
                document.getElementById('shortcuts-help').style.display = 'none';
            }
        });

        // Google Apps Script ready handler
        function onGASReady() {
            console.log('Google Apps Script client library loaded');
        }

        // Fallback if GAS library doesn't load
        setTimeout(function() {
            if (!window.google || !window.google.script) {
                console.warn('Google Apps Script library not available, using fallback');
                window.google = {
                    script: {
                        run: {
                            withSuccessHandler: function(callback) {
                                return {
                                    withFailureHandler: function(errorCallback) {
                                        return {
                                            getProjectData: function(projectId) {
                                                // Fallback for development
                                                callback({
                                                    project: {
                                                        id: projectId,
                                                        title: 'Sample Project',
                                                        description: 'Development sample project',
                                                        createdAt: new Date().toISOString(),
                                                        updatedAt: new Date().toISOString(),
                                                        spreadsheetId: 'dev-spreadsheet',
                                                        settings: {
                                                            autoSave: true,
                                                            theme: 'light',
                                                            analytics: true
                                                        }
                                                    },
                                                    slides: [
                                                        {
                                                            id: 'slide-1',
                                                            projectId: projectId,
                                                            title: 'Sample Slide',
                                                            mediaType: 'image',
                                                            mediaUrl: 'https://via.placeholder.com/800x600/007bff/ffffff?text=Sample+Image',
                                                            order: 0,
                                                            transition: 'fade'
                                                        }
                                                    ],
                                                    hotspots: []
                                                });
                                            },
                                            saveHotspots: function(projectId, hotspots) {
                                                console.log('Saving hotspots:', hotspots);
                                                callback();
                                            },
                                            saveSlides: function(projectId, slides) {
                                                console.log('Saving slides:', slides);
                                                callback();
                                            }
                                        };
                                    }
                                };
                            }
                        }
                    }
                };
            }
        }, 2000);

        // Prevent accidental page navigation
        window.addEventListener('beforeunload', function(e) {
            if (document.querySelector('.saving-indicator')) {
                e.preventDefault();
                e.returnValue = 'Changes are being saved. Are you sure you want to leave?';
                return e.returnValue;
            }
        });

        // Auto-save indicator
        let autoSaveTimeout;
        window.showAutoSaveIndicator = function() {
            clearTimeout(autoSaveTimeout);
            const indicator = document.createElement('div');
            indicator.textContent = '‚úì Auto-saved';
            indicator.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 8px 16px; border-radius: 4px; z-index: 2000; font-size: 14px; opacity: 0; transition: opacity 0.3s;';
            document.body.appendChild(indicator);

            setTimeout(() => indicator.style.opacity = '1', 10);
            autoSaveTimeout = setTimeout(() => {
                indicator.style.opacity = '0';
                setTimeout(() => document.body.removeChild(indicator), 300);
            }, 2000);
        };
    </script>

    <!-- Editor app bundle will be injected by webpack -->
</body>
</html>